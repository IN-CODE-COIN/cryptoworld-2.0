FROM php:8.2-cli

# Instalar dependencias del sistema necesarias
RUN apt-get update \
    && apt-get install -y unzip git curl \
    && rm -rf /var/lib/apt/lists/*

# Instalar Composer manualmente
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer

WORKDIR /var/www/html

# Copiar dependencias de Laravel
COPY composer.json composer.lock ./

# Instalar dependencias de PHP
RUN composer install --no-dev --no-scripts --no-progress --prefer-dist

# Copiar el resto del backend
COPY . .

# Instalar extensi√≥n PDO MySQL para Laravel
RUN docker-php-ext-install pdo_mysql

# Exponer puerto
EXPOSE 8000

# Ejecutar Laravel
CMD ["php", "artisan", "serve", "--host=0.0.0.0", "--port=8000"]
